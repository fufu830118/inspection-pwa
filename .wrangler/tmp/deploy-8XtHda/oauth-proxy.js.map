{
  "version": 3,
  "sources": ["../../../worker/oauth-proxy.js"],
  "sourceRoot": "C:\\Users\\f2302\\Desktop\\\u6AA2\u9EDE\u7CFB\u7D71\\inspection-pwa\\.wrangler\\tmp\\deploy-8XtHda",
  "sourcesContent": ["// Cloudflare Worker - OAuth Proxy\r\n// \u7528\u9014\uFF1A\u4EE3\u7406 Wiwynn OAuth \u8ACB\u6C42\uFF0C\u89E3\u6C7A CORS \u554F\u984C\r\n\r\nexport default {\r\n    async fetch(request, env) {\r\n        // \u53EA\u5141\u8A31\u7279\u5B9A\u4F86\u6E90\r\n        const allowedOrigins = [\r\n            'https://inspection-pwa.pages.dev',\r\n            'https://7f5c9fc7.inspection-pwa.pages.dev',\r\n            'https://306711ef.inspection-pwa.pages.dev',\r\n            'http://localhost:5173',\r\n            'https://localhost:5173'\r\n        ];\r\n\r\n        const origin = request.headers.get('Origin');\r\n        const isAllowedOrigin = allowedOrigins.some(allowed =>\r\n            origin && origin.startsWith(allowed.split('://')[0] + '://') &&\r\n            (origin === allowed || origin.includes('.inspection-pwa.pages.dev'))\r\n        );\r\n\r\n        // CORS preflight\r\n        if (request.method === 'OPTIONS') {\r\n            return new Response(null, {\r\n                headers: {\r\n                    'Access-Control-Allow-Origin': isAllowedOrigin ? origin : allowedOrigins[0],\r\n                    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\r\n                    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n                    'Access-Control-Max-Age': '86400',\r\n                },\r\n            });\r\n        }\r\n\r\n        const url = new URL(request.url);\r\n\r\n        // \u8DEF\u7531\u8655\u7406\r\n        if (url.pathname === '/token') {\r\n            return handleTokenRequest(request, origin, isAllowedOrigin, allowedOrigins);\r\n        } else if (url.pathname === '/userinfo') {\r\n            return handleUserInfoRequest(request, origin, isAllowedOrigin, allowedOrigins);\r\n        }\r\n\r\n        return new Response('Not Found', { status: 404 });\r\n    },\r\n};\r\n\r\n// \u8655\u7406 Token Exchange \u8ACB\u6C42\r\nasync function handleTokenRequest(request, origin, isAllowedOrigin, allowedOrigins) {\r\n    if (request.method !== 'POST') {\r\n        return new Response('Method Not Allowed', { status: 405 });\r\n    }\r\n\r\n    try {\r\n        const body = await request.text();\r\n        const authHeader = request.headers.get('Authorization');\r\n\r\n        const response = await fetch('https://one.wiwynn.com/oauth/v2.0/token', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded',\r\n                'Authorization': authHeader,\r\n            },\r\n            body: body,\r\n        });\r\n\r\n        const data = await response.text();\r\n\r\n        return new Response(data, {\r\n            status: response.status,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Access-Control-Allow-Origin': isAllowedOrigin ? origin : allowedOrigins[0],\r\n                'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n                'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n            },\r\n        });\r\n    } catch (error) {\r\n        return new Response(JSON.stringify({ error: error.message }), {\r\n            status: 500,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Access-Control-Allow-Origin': isAllowedOrigin ? origin : allowedOrigins[0],\r\n            },\r\n        });\r\n    }\r\n}\r\n\r\n// \u8655\u7406 UserInfo \u8ACB\u6C42\r\nasync function handleUserInfoRequest(request, origin, isAllowedOrigin, allowedOrigins) {\r\n    if (request.method !== 'GET') {\r\n        return new Response('Method Not Allowed', { status: 405 });\r\n    }\r\n\r\n    try {\r\n        const authHeader = request.headers.get('Authorization');\r\n\r\n        const response = await fetch('https://one.wiwynn.com/oauth/v2.0/userinfo', {\r\n            headers: {\r\n                'Authorization': authHeader,\r\n            },\r\n        });\r\n\r\n        const data = await response.text();\r\n\r\n        return new Response(data, {\r\n            status: response.status,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Access-Control-Allow-Origin': isAllowedOrigin ? origin : allowedOrigins[0],\r\n                'Access-Control-Allow-Methods': 'GET, OPTIONS',\r\n                'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n            },\r\n        });\r\n    } catch (error) {\r\n        return new Response(JSON.stringify({ error: error.message }), {\r\n            status: 500,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Access-Control-Allow-Origin': isAllowedOrigin ? origin : allowedOrigins[0],\r\n            },\r\n        });\r\n    }\r\n}\r\n"],
  "mappings": ";;;;AAGA,IAAO,sBAAQ;AAAA,EACX,MAAM,MAAM,SAAS,KAAK;AAEtB,UAAM,iBAAiB;AAAA,MACnB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAEA,UAAM,SAAS,QAAQ,QAAQ,IAAI,QAAQ;AAC3C,UAAM,kBAAkB,eAAe;AAAA,MAAK,aACxC,UAAU,OAAO,WAAW,QAAQ,MAAM,KAAK,EAAE,CAAC,IAAI,KAAK,MAC1D,WAAW,WAAW,OAAO,SAAS,2BAA2B;AAAA,IACtE;AAGA,QAAI,QAAQ,WAAW,WAAW;AAC9B,aAAO,IAAI,SAAS,MAAM;AAAA,QACtB,SAAS;AAAA,UACL,+BAA+B,kBAAkB,SAAS,eAAe,CAAC;AAAA,UAC1E,gCAAgC;AAAA,UAChC,gCAAgC;AAAA,UAChC,0BAA0B;AAAA,QAC9B;AAAA,MACJ,CAAC;AAAA,IACL;AAEA,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAG/B,QAAI,IAAI,aAAa,UAAU;AAC3B,aAAO,mBAAmB,SAAS,QAAQ,iBAAiB,cAAc;AAAA,IAC9E,WAAW,IAAI,aAAa,aAAa;AACrC,aAAO,sBAAsB,SAAS,QAAQ,iBAAiB,cAAc;AAAA,IACjF;AAEA,WAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAAA,EACpD;AACJ;AAGA,eAAe,mBAAmB,SAAS,QAAQ,iBAAiB,gBAAgB;AAChF,MAAI,QAAQ,WAAW,QAAQ;AAC3B,WAAO,IAAI,SAAS,sBAAsB,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC7D;AAEA,MAAI;AACA,UAAM,OAAO,MAAM,QAAQ,KAAK;AAChC,UAAM,aAAa,QAAQ,QAAQ,IAAI,eAAe;AAEtD,UAAM,WAAW,MAAM,MAAM,2CAA2C;AAAA,MACpE,QAAQ;AAAA,MACR,SAAS;AAAA,QACL,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,MACrB;AAAA,MACA;AAAA,IACJ,CAAC;AAED,UAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,WAAO,IAAI,SAAS,MAAM;AAAA,MACtB,QAAQ,SAAS;AAAA,MACjB,SAAS;AAAA,QACL,gBAAgB;AAAA,QAChB,+BAA+B,kBAAkB,SAAS,eAAe,CAAC;AAAA,QAC1E,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MACpC;AAAA,IACJ,CAAC;AAAA,EACL,SAAS,OAAO;AACZ,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG;AAAA,MAC1D,QAAQ;AAAA,MACR,SAAS;AAAA,QACL,gBAAgB;AAAA,QAChB,+BAA+B,kBAAkB,SAAS,eAAe,CAAC;AAAA,MAC9E;AAAA,IACJ,CAAC;AAAA,EACL;AACJ;AAtCe;AAyCf,eAAe,sBAAsB,SAAS,QAAQ,iBAAiB,gBAAgB;AACnF,MAAI,QAAQ,WAAW,OAAO;AAC1B,WAAO,IAAI,SAAS,sBAAsB,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC7D;AAEA,MAAI;AACA,UAAM,aAAa,QAAQ,QAAQ,IAAI,eAAe;AAEtD,UAAM,WAAW,MAAM,MAAM,8CAA8C;AAAA,MACvE,SAAS;AAAA,QACL,iBAAiB;AAAA,MACrB;AAAA,IACJ,CAAC;AAED,UAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,WAAO,IAAI,SAAS,MAAM;AAAA,MACtB,QAAQ,SAAS;AAAA,MACjB,SAAS;AAAA,QACL,gBAAgB;AAAA,QAChB,+BAA+B,kBAAkB,SAAS,eAAe,CAAC;AAAA,QAC1E,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MACpC;AAAA,IACJ,CAAC;AAAA,EACL,SAAS,OAAO;AACZ,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG;AAAA,MAC1D,QAAQ;AAAA,MACR,SAAS;AAAA,QACL,gBAAgB;AAAA,QAChB,+BAA+B,kBAAkB,SAAS,eAAe,CAAC;AAAA,MAC9E;AAAA,IACJ,CAAC;AAAA,EACL;AACJ;AAlCe;",
  "names": []
}
