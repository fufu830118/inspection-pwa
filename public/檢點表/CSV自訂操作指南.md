# 檢點系統 CSV 自訂操作指南

## 📋 目錄
1. [總覽](#總覽)
2. [類別配置自訂](#類別配置自訂)
3. [設備清單自訂](#設備清單自訂)
4. [檢點項目自訂](#檢點項目自訂)
5. [常見問題](#常見問題)

---

## 總覽

### 檔案位置
所有配置檔案都在：`public/檢點表/`

```
public/檢點表/
├── 類別配置.csv          ← 管理所有類別的頻率和圖示
├── 設備清單範本.csv      ← 參考範本
├── 檢點項目範本.csv      ← 參考範本
│
├── 滅火器/
│   ├── 設備清單.csv
│   └── 檢點項目.csv
│
├── 自動門/
│   ├── 設備清單.csv
│   └── 檢點項目.csv
...
```

### 重要提醒

> [!CAUTION]
> **編輯 CSV 檔案的注意事項**
> 1. ✅ 使用 **記事本** 或 **Visual Studio Code** 編輯
> 2. ✅ 存檔時選擇 **UTF-8 with BOM** 編碼
> 3. ❌ **不要用 Excel 直接存檔**（會破壞編碼）
> 4. ✅ 如果要用 Excel 編輯，編輯完後用記事本重新存成 UTF-8 with BOM

---

## 類別配置自訂

### 檔案：`類別配置.csv`

這個檔案控制所有設備類別的基本設定。

### 欄位說明

| 欄位名稱 | 必填 | 說明 | 範例 |
|---------|------|------|------|
| 類別ID | ✅ 必填 | 唯一編號，數字1-15 | `1` |
| 類別名稱 | ✅ 必填 | 中文名稱 | `滅火器` |
| 圖示 | ✅ 必填 | Emoji 表情符號 | `🧯` |
| 頻率 | ✅ 必填 | 檢查頻率 | `每月` / `每週` / `每季` |
| ID前綴 | ✅ 必填 | 設備編號前綴 | `FIREXT` |

### 頻率選項

系統支援三種檢查頻率：

| 頻率 | 說明 | 進度重置時間 | 適用設備 |
|------|------|-------------|---------|
| **每週** | 每週檢查一次 | 每週一 | 會議室 |
| **每月** | 每月檢查一次 | 每月1日 | 滅火器、逃生門等 |
| **每季** | 每季檢查一次 | 每季第一天 | 自動門 |

### 範例

```csv
類別ID,類別名稱,圖示,頻率,ID前綴
1,滅火器,🧯,每月,FIREXT
2,自動門,🚪,每季,AUTD
3,逃生門,🚪,每月,EXIT
15,會議室,🏢,每週,ROOM
```

### 如何修改頻率

**情境**：想要將「自動門」的檢查頻率從每季改為每月

1. 用記事本開啟 `類別配置.csv`
2. 找到自動門那一行：
   ```csv
   2,自動門,🚪,每季,AUTD
   ```
3. 將 `每季` 改為 `每月`：
   ```csv
   2,自動門,🚪,每月,AUTD
   ```
4. 存檔時選擇 **UTF-8 with BOM** 編碼
5. 重新整理網頁即可看到變更

---

## 設備清單自訂

每個類別資料夾都有一個 `設備清單.csv`，用來記錄該類別的所有設備。

### 固定欄位（前兩欄，不可更改）

| 欄位 | 必填 | 說明 | 範例 |
|------|------|------|------|
| **設備ID** | ✅ 必填 | 唯一設備編號 | `FIREXT-A23-A1-01-1` |
| **QR碼** | ✅ 必填 | QR Code 掃描內容（亂碼） | `eb683c52ea672e08` |

> [!IMPORTANT]
> **前兩欄絕對不能改名或刪除！** 系統必須依賴這兩欄來識別設備。

### 自訂欄位（第三欄之後，可自由新增）

第三欄之後的欄位可以根據設備特性自由新增，系統會**自動識別並顯示**。

#### 常用欄位範例

| 欄位名稱 | 適用設備 | 說明 |
|---------|---------|------|
| 位置 | 所有設備 | 設備所在位置 |
| 類型 / 滅火器類型 / 門類型 | 滅火器、自動門等 | 設備類型 |
| 尺寸 | 滅火器、冷氣機 | 設備尺寸規格 |
| 有效日期 / 到期日 | 滅火器 | 有效期限（系統會自動提醒快到期） |
| 廠牌 | 自動門、事務機 | 製造廠商 |
| 型號 | 自動門、事務機 | 產品型號 |
| 規格 | 電盤、冷氣機 | 技術規格 |
| 電壓 | 電盤 | 額定電壓 |
| 電流 | 電盤 | 額定電流 |

### 範例：滅火器設備清單

```csv
設備ID,QR碼,位置,滅火器類型,尺寸,有效日期
FIREXT-A23-A1-01-1,eb683c52ea672e08,A23FA1區,乾粉,20型,2027/10/26
FIREXT-A23-A1-01-2,5893231083e5f3db,A23FA1區,乾粉,20型,2027/10/26
```

### 範例：自動門設備清單

```csv
設備ID,QR碼,位置,廠牌,型號,安裝日期
AUTD-B1-01,abc123def456,B1F大廳,日立,HD-2000,2023/05/15
AUTD-B1-02,xyz789ghi012,B1F側門,三菱,MT-5000,2023/05/20
```

### 如何新增自訂欄位

**情境**：想在滅火器清單中新增「負責人」欄位

1. 用記事本或 Excel 開啟 `滅火器/設備清單.csv`

2. **原始檔案**：
   ```csv
   設備ID,QR碼,位置,滅火器類型,尺寸,有效日期
   FIREXT-A23-A1-01-1,eb683c52ea672e08,A23FA1區,乾粉,20型,2027/10/26
   ```

3. **在標題列新增「負責人」欄位**：
   ```csv
   設備ID,QR碼,位置,滅火器類型,尺寸,有效日期,負責人
   FIREXT-A23-A1-01-1,eb683c52ea672e08,A23FA1區,乾粉,20型,2027/10/26,王小明
   ```

4. 存檔為 **UTF-8 with BOM**
5. 重新整理網頁，新欄位會自動顯示！

---

## 檢點項目自訂

每個類別資料夾都有一個 `檢點項目.csv`，定義該類別的檢查表單。

### 欄位說明

| 欄位名稱 | 必填 | 說明 | 範例 |
|---------|------|------|------|
| 檢查項目 | ✅ 必填 | 檢查項目的問題描述 | `瓶身外觀是否無鏽蝕狀況` |
| 欄位類型 | ✅ 必填 | 題型：`布林` / `數字` / `簡答` | `布林` |
| 說明 | ✅ 必填 | 檢查重點說明 | `檢查滅火器瓶身是否有鏽蝕、損傷或變形` |
| 合格條件 | ✅ 必填 | 正常標準 | `瓶身外觀正常無鏽蝕` |
| 不合格條件 | ✅ 必填 | 異常標準 | `瓶身有鏽蝕、損傷或變形` |
| 必填 | ✅ 必填 | 是否必填：`是` / `否` | `是` |

### 題型說明

| 題型 | UI 顯示 | 適用情境 |
|------|---------|---------|
| **布林** | 大型「正常 / 異常」按鈕 | 檢查項目有明確的對錯（最常用） |
| **數字** | 數字輸入框 | 需要填寫數值（電壓、溫度、數量等） |
| **簡答** | 多行文字框 | 需要填寫說明文字（備註、問題描述） |

### 範例：滅火器檢點項目

```csv
檢查項目,欄位類型,說明,合格條件,不合格條件,必填
瓶身外觀是否無鏽蝕狀況,布林,檢查滅火器瓶身是否有鏽蝕、損傷或變形,瓶身外觀正常無鏽蝕,瓶身有鏽蝕、損傷或變形,是
壓力指示值是否在有效範圍(綠色)內,布林,檢查壓力表指針是否在綠色區域內,壓力指針在綠色區域內,壓力指針在黃色或紅色區域,是
其他與問題描述,簡答,記錄其他異常情況或問題描述,,-,否
```

---

## 常見問題

### Q1: 如何確保 CSV 是 UTF-8 with BOM 編碼？

**PowerShell 批次轉換**：
```powershell
# 轉換整個資料夾的所有 CSV
Get-ChildItem -Recurse -Filter "*.csv" | ForEach-Object { 
    $content = Get-Content $_.FullName -Raw -Encoding UTF8
    $utf8BomEncoding = New-Object System.Text.UTF8Encoding $true
    [System.IO.File]::WriteAllText($_.FullName, $content, $utf8BomEncoding)
}
```

### Q2: Excel 打開 CSV 亂碼怎麼辦？

檔案本身可能沒有 BOM，請用上述方法轉換編碼。

### Q3: 設備清單可以有多少個自訂欄位？

**沒有限制**！系統會自動識別所有欄位（除了固定的「設備ID」和「QR碼」）。

### Q4: 「有效日期」欄位如何觸發到期提醒？

系統會自動識別欄位名稱包含「有效日期」或「到期日」的欄位，如果：
- 距離到期日 ≤ 6 個月：顯示紅色警告 ⚠️
- 距離到期日 > 6 個月：顯示綠色

**日期格式**：`YYYY/MM/DD`（例如：2027/10/26）

### Q5: 修改 CSV 後需要重新啟動伺服器嗎？

**不需要**！只需重新整理網頁即可。
